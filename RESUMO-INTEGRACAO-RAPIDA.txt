================================================================================
  SISTEMA DE INTEGRACAO RAPIDA ALTERDATA
  Versao: 1.0 | Data: 15/12/2025
================================================================================

PROBLEMA RESOLVIDO:
  O sistema antigo copiava TODO o banco (GB de dados, varios minutos).
  O novo sistema extrai APENAS as tabelas necessarias (MB, poucos segundos).

RESULTADO:
  100x MAIS RAPIDO | 250x MENOR | 24x MAIS FREQUENTE

================================================================================
  COMPARACAO: ANTIGO VS NOVO
================================================================================

SISTEMA ANTIGO (Copia Completa):
  Tempo: ~5-10 minutos
  Tamanho: ~5GB copiados
  Frequencia maxima: A cada 4 horas
  Impacto: Alto (copia arquivos)
  Uso: Backup completo

SISTEMA NOVO (Integracao Rapida):
  Tempo: ~5-10 segundos ‚ö°
  Tamanho: ~20MB extraidos ‚ö°
  Frequencia maxima: A cada 10 minutos ‚ö°
  Impacto: Baixo (query SQL) ‚ö°
  Uso: Integracao em tempo real ‚ö°

================================================================================
  O QUE E EXTRAIDO?
================================================================================

APENAS 2 TABELAS DO POSTGRESQL:

1. produto
   - idproduto (ID)
   - cdchamada (codigo)
   - nmproduto (descricao)
   - stativo (status)

2. detalhe
   - vlprecovenda (preco)
   - qtestoque (estoque)
   - stinativo (status)

QUERY OTIMIZADA:
  SELECT p.*, d.* FROM produto p
  LEFT JOIN detalhe d ON p.idproduto = d.idproduto
  WHERE p.stativo = 'S'

RESULTADO:
  Arquivo JSON com todos os produtos ativos + precos + estoque

================================================================================
  ARQUIVOS CRIADOS (5 NOVOS)
================================================================================

SCRIPTS:
  [x] scripts\integracao-rapida-alterdata.py      - Script Python principal
  [x] AGENDAR-INTEGRACAO-RAPIDA.bat               - Configura agendamento
  [x] VER-INTEGRACAO-RAPIDA.bat                   - Ver status e logs
  [x] INTEGRACAO-AUTOMATICA-RAPIDA.bat            - Executado pelo agendador

DOCUMENTACAO:
  [x] DOCUMENTACAO-INTEGRACAO-RAPIDA.md           - Documentacao completa
  [x] RESUMO-INTEGRACAO-RAPIDA.txt                - Este arquivo

SAIDA:
  data\produtos.json                              - Dados extraidos
  logs\integracao_rapida_*.log                    - Logs de execucao

================================================================================
  COMO COMECAR (3 PASSOS)
================================================================================

PASSO 1 - TESTAR MANUALMENTE:
  python scripts\integracao-rapida-alterdata.py

  Resultado esperado:
    - Conecta no PostgreSQL
    - Extrai produtos + detalhes
    - Salva em data\produtos.json
    - Mostra estatisticas

PASSO 2 - CONFIGURAR AGENDAMENTO:
  AGENDAR-INTEGRACAO-RAPIDA.bat

  Escolha frequencia (recomendado: 20 minutos)

PASSO 3 - VERIFICAR:
  VER-INTEGRACAO-RAPIDA.bat

  Confira:
    - Tarefa agendada ativa
    - Logs sendo gerados
    - produtos.json sendo atualizado

PRONTO! Sistema integrado automaticamente! üöÄ

================================================================================
  OPCOES DE AGENDAMENTO
================================================================================

1. A cada 10 minutos  - Tempo quase real (e-commerce ativo)
2. A cada 20 minutos  - RECOMENDADO para producao ‚≠ê
3. A cada 30 minutos  - Uso moderado
4. A cada 60 minutos  - 1 hora
5. A cada 2 horas     - Uso leve
6. A cada 4 horas     - Backup/seguranca

ESCOLHA BASEADO EM:
  - Volume de vendas
  - Necessidade de dados atualizados
  - Capacidade do servidor

E-commerce ativo ‚Üí 10-20 min
Loja fisica + site ‚Üí 30-60 min
Catalogo/consulta ‚Üí 2-4 horas

================================================================================
  COMANDOS RAPIDOS
================================================================================

EXECUCAO MANUAL:
  python scripts\integracao-rapida-alterdata.py
  
CONFIGURAR:
  AGENDAR-INTEGRACAO-RAPIDA.bat

VER STATUS:
  VER-INTEGRACAO-RAPIDA.bat

AGENDADOR:
  schtasks /query /tn "IntegracaoRapidaAlterdata"      # Ver status
  schtasks /run /tn "IntegracaoRapidaAlterdata"        # Executar agora
  schtasks /change /tn "IntegracaoRapidaAlterdata" /disable   # Desabilitar
  schtasks /change /tn "IntegracaoRapidaAlterdata" /enable    # Habilitar
  schtasks /delete /tn "IntegracaoRapidaAlterdata" /f         # Remover

VER DADOS:
  type data\produtos.json

VER LOGS:
  dir logs\integracao_rapida_*.log
  type logs\integracao_rapida_<timestamp>.log

================================================================================
  FORMATO DOS DADOS (JSON)
================================================================================

Arquivo: data\produtos.json

Estrutura:
  [
    {
      "id": 12345,
      "codigo": "PROD001",
      "descricao": "PRODUTO EXEMPLO",
      "ativo": "S",
      "valor": 99.90,
      "estoque": 10,
      "inativo_detalhe": "N"
    },
    ...
  ]

Uso em Python:
  import json
  
  with open('data/produtos.json', 'r', encoding='utf-8') as f:
      produtos = json.load(f)
  
  for p in produtos:
      print(f"{p['codigo']} - {p['descricao']} - R$ {p['valor']}")

================================================================================
  ESTATISTICAS GERADAS
================================================================================

Cada execucao gera:
  - Total de produtos
  - Produtos com estoque
  - Produtos sem estoque
  - Total de itens em estoque
  - Valor total em estoque
  - Preco medio

Exemplo:
  Total de produtos: 1523
  Produtos com estoque: 892
  Produtos sem estoque: 631
  Total itens em estoque: 15234
  Valor total em estoque: R$ 425,678.90
  Preco medio: R$ 45.67

================================================================================
  FLUXO DE TRABALHO
================================================================================

DIA A DIA (AUTOMATICO):

  Agendador Windows (a cada X minutos)
       ‚Üì
  INTEGRACAO-AUTOMATICA-RAPIDA.bat
       ‚Üì
  integracao-rapida-alterdata.py
       ‚Üì
  PostgreSQL ALTERDATA_SHOP (porta detectada)
       ‚Üì
  Extrai: produto + detalhe (WHERE stativo = 'S')
       ‚Üì
  Salva: data\produtos.json (atualizado)
       ‚Üì
  Sistema Web/API (le dados atualizados)

MONITORAMENTO (SEMANAL):

  1. VER-INTEGRACAO-RAPIDA.bat (verificar status)
  2. Conferir logs (erros?)
  3. Validar data\produtos.json (atualizado?)
  4. Limpar logs antigos (manter ultimos 30 dias)

================================================================================
  MIGRACAO DO SISTEMA ANTIGO
================================================================================

SE VOCE USA O SISTEMA DE COPIA COMPLETA:

Opcao 1 - SUBSTITUIR (Recomendado):
  1. Remover agendamento antigo:
     schtasks /delete /tn "CopiarBancosAlterdata" /f
  
  2. Configurar novo sistema:
     AGENDAR-INTEGRACAO-RAPIDA.bat
  
  3. Beneficios:
     - 100x mais rapido
     - Menos espaco em disco
     - Integracao mais frequente

Opcao 2 - COEXISTIR:
  - Integracao rapida: Dados do dia (produto, preco, estoque)
  - Copia completa: Backup completo (menos frequente)
  
  Ambos podem rodar simultaneamente!

================================================================================
  REQUISITOS
================================================================================

OBRIGATORIO:
  [x] Windows com Task Scheduler
  [x] Python 3.x instalado
  [x] Modulo psycopg2 (pip install psycopg2-binary)
  [x] PostgreSQL Alterdata rodando
  [x] Banco ALTERDATA_SHOP acessivel
  [x] Permissao de conexao (trust mode)

OPCIONAL:
  [x] Espaco em disco: ~100MB (logs + dados)

VERIFICAR:
  python --version
  pip list | findstr psycopg2

INSTALAR SE NECESSARIO:
  pip install psycopg2-binary

================================================================================
  SOLUCAO DE PROBLEMAS
================================================================================

ERRO: "PostgreSQL nao encontrado"
SOLUCAO:
  - Verifique se Alterdata esta aberto
  - Teste: psql -h localhost -p 5433 -U postgres -l
  - Verifique servico: services.msc

ERRO: "Falha ao conectar"
SOLUCAO:
  - Configure trust mode no pg_hba.conf
  - Reinicie PostgreSQL
  - Teste manualmente: python scripts\integracao-rapida-alterdata.py

ERRO: "Tabela produto nao existe"
SOLUCAO:
  - Verifique estrutura do banco: psql -c "\dt"
  - Confirme banco ALTERDATA_SHOP existe
  - Consulte documentacao Alterdata

ERRO: "Agendamento nao executa"
SOLUCAO:
  - VER-INTEGRACAO-RAPIDA.bat (verificar status)
  - Habilitar: schtasks /change /tn "IntegracaoRapidaAlterdata" /enable
  - Testar: schtasks /run /tn "IntegracaoRapidaAlterdata"

ARQUIVO NAO ATUALIZA:
SOLUCAO:
  - Verificar logs: dir logs\integracao_rapida_*.log
  - Executar manual: python scripts\integracao-rapida-alterdata.py
  - Verificar permissoes na pasta data\

================================================================================
  INTEGRACAO COM SISTEMA WEB
================================================================================

PYTHON (Flask/Django):
  import json
  from pathlib import Path
  
  def get_produtos():
      with open('data/produtos.json', 'r', encoding='utf-8') as f:
          return json.load(f)
  
  produtos = get_produtos()

JAVASCRIPT (Node.js):
  const fs = require('fs');
  const produtos = JSON.parse(
      fs.readFileSync('data/produtos.json', 'utf8')
  );

PHP:
  $produtos = json_decode(
      file_get_contents('data/produtos.json'),
      true
  );

API REST:
  GET /api/produtos
    ‚Üí Le data/produtos.json
    ‚Üí Retorna JSON

================================================================================
  VANTAGENS DO SISTEMA OTIMIZADO
================================================================================

PERFORMANCE:
  ‚úÖ 100x mais rapido (segundos vs minutos)
  ‚úÖ 250x menor (MB vs GB)
  ‚úÖ 24x mais frequente (10 min vs 4 horas)

OPERACAO:
  ‚úÖ Integracao em tempo quase real
  ‚úÖ Menos impacto no servidor
  ‚úÖ Menor uso de disco
  ‚úÖ Logs menores e mais claros

MANUTENCAO:
  ‚úÖ Mais simples de monitorar
  ‚úÖ Menos problemas de espaco
  ‚úÖ Facil de debugar
  ‚úÖ Logs mais legiveis

NEGOCIO:
  ‚úÖ Dados sempre atualizados
  ‚úÖ Menos vendas de produtos sem estoque
  ‚úÖ Precos sempre corretos
  ‚úÖ Melhor experiencia do cliente

================================================================================
  PROXIMOS PASSOS
================================================================================

AGORA:
  1. [ ] Executar teste manual
  2. [ ] Verificar data\produtos.json criado
  3. [ ] Configurar agendamento
  4. [ ] Monitorar primeira execucao automatica

ESTA SEMANA:
  5. [ ] Integrar com sistema web
  6. [ ] Validar dados em producao
  7. [ ] Configurar alertas (opcional)

MANUTENCAO:
  8. [ ] Verificar logs semanalmente
  9. [ ] Limpar logs antigos mensalmente
  10. [ ] Ajustar frequencia se necessario

================================================================================
  CHECKLIST DE CONFIGURACAO
================================================================================

Pre-requisitos:
  [ ] Python instalado
  [ ] psycopg2 instalado
  [ ] PostgreSQL Alterdata rodando
  [ ] Banco ALTERDATA_SHOP acessivel

Configuracao:
  [ ] Teste manual executado com sucesso
  [ ] data\produtos.json criado
  [ ] Agendamento configurado
  [ ] Tarefa agendada ativa
  [ ] Primeira execucao automatica OK

Validacao:
  [ ] Logs sendo gerados em logs\
  [ ] produtos.json sendo atualizado
  [ ] Dados corretos no JSON
  [ ] Sistema web integrado

Documentacao:
  [ ] Equipe treinada no uso
  [ ] Documentacao lida
  [ ] Contatos de suporte definidos

================================================================================
  DOCUMENTACAO DISPONIVEL
================================================================================

Completa:
  DOCUMENTACAO-INTEGRACAO-RAPIDA.md        - Guia detalhado
  
Rapida:
  RESUMO-INTEGRACAO-RAPIDA.txt             - Este arquivo
  
Sistema Completo:
  DOCUMENTACAO-BANCOS-ALTERDATA.md         - Sistema antigo (copia completa)
  
Repositorio:
  https://github.com/ronaldomelofz/tabela

================================================================================
  SUPORTE
================================================================================

Diagnostico:
  VER-INTEGRACAO-RAPIDA.bat
  python scripts\integracao-rapida-alterdata.py

Logs:
  dir logs\integracao_rapida_*.log

Repositorio:
  https://github.com/ronaldomelofz/tabela

================================================================================
  FIM DO RESUMO
================================================================================

PARA COMECAR:
  python scripts\integracao-rapida-alterdata.py

DEPOIS:
  AGENDAR-INTEGRACAO-RAPIDA.bat

MONITORAR:
  VER-INTEGRACAO-RAPIDA.bat

BOA INTEGRACAO! ‚ö°

================================================================================
Versao: 1.0
Data: 15/12/2025
Sistema: Integracao Rapida Alterdata
Autor: Sistema de Automacao Tabela Preco Estoque
================================================================================

